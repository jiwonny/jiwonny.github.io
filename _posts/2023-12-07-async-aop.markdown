---
categories: study 
title: "@Asyncë¡œ ë§›ë³¸ ìŠ¤í”„ë§ í”„ë¡ì‹œ"
excerpt: "2023-12-07"
taxonomy: study
toc: true
toc_sticky: true
toc_label: ëª©ì°¨
tags:
    - Spring
author_profile: true
---
<br>

## ë“¤ì–´ê°€ë©°
ì´ë²ˆì— íšŒì‚¬ì—ì„œ 'ì‘ì—… ìš”ì²­ ê¸°ëŠ¥'ì„ ìƒˆë¡­ê²Œ ê°œë°œí•˜ê²Œ ë˜ì—ˆë‹¤. 

ì–´ë“œë¯¼ í˜ì´ì§€ì—ì„œ "ì´ëŸ° ì €ëŸ° ì‘ì—…ì´ í•„ìš”í•´ìš”. ì´ê±° ì²˜ë¦¬í•´ì£¼ì„¸ìš”!" ë¼ëŠ” ìš”ì²­ì„ ë‚¨ê¸°ë©´, ì‘ì—…ì ì•±ì—ì„œ ìš”ì²­ì„ í™•ì¸í•˜ê³  ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ë‹¤.
ì²˜ìŒì—ëŠ” ì–´ë“œë¯¼ì—ì„œ ì´ ì‘ì—… ì§€ì‹œë¥¼ ìƒì„±í•˜ê³ , ì‘ì—…ì ì•±ì—ì„œ ì‘ì—… ì§€ì‹œë¥¼ í™•ì¸í•˜ëŠ” ê¸°ëŠ¥ë§Œ ëšë”± ë§Œë“¤ì—ˆë‹¤.

> ë³„ê±° ì—†ë„¤!

ê·¸ëŸ°ë° ì´ "ì‘ì—… ìš”ì²­" ê¸°ëŠ¥ì€ ì¼ì„ ë¹ ë¥´ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•¨ì´ë¼, ì‘ì—… ìš”ì²­ì´ ìƒì„±ë˜ì—ˆì„ ë•Œ ê´€ê³„ìë“¤ì´ ì´ë¥¼ ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆë‹¤ë©´ ë”ìš± ì¢‹ì„ ê²ƒ ê°™ì•˜ë‹¤.
ê·¸ë˜ì„œ ì‘ì—… ìš”ì²­ì´ ìƒì„±ë˜ì—ˆì„ ë•Œ ê´€ê³„ìë“¤ì—ê²Œ ë¹ ë¥´ê²Œ ì•Œë¦´ ìˆ˜ ìˆëŠ” <b>ë¶€ê°€ ê¸°ëŠ¥</b>ì„ ë„£ì–´ë³´ê¸°ë¡œ í–ˆë‹¤. 
íšŒì‚¬ ë‚´ë¶€ ê´€ê³„ìì—ê²ŒëŠ” ìŠ¬ë™ìœ¼ë¡œ ì•Œë¦¼ì„ ì£¼ê³ , ì‘ì—…ìì—ê²ŒëŠ” ì‘ì—…ì ì•±ìœ¼ë¡œ í‘¸ì‹œ ì•Œë¦¼ì„ ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ.

ì‘ì—… ìš”ì²­ì„ ìƒì„±í•˜ëŠ” ì½”ë“œì— ì´ ë‘ ë¡œì§ì„ ì¶”ê°€í•˜ë©´ ë˜ê² ë‹¤! ê°„ë‹¨í•œê±¸! ì´ë¼ ìƒê°í•˜ë©° ëšë”±ì˜ ê¸¸ë¡œ ë“¤ì–´ì„°ë‹¤.

```java
@Service
@RequiredArgsConstructor
public class WorkInstructionService {
    // ìƒëµ
    // ê°ì¢… repository, domain service ì£¼ì… 
    
    @Transactional
    public void createWorkInstruction(Long memberId, String vehicleId, String description, WorkInstructionType instructionType, LocalDateTime requestAt) {
        Vehicle vehicle = getVehicle(vehicleId);
        Member instructMember = getMember(memberId);
        
        WorkInstructionEntity workInstruction = WorkInstructionEntity.builder()
                .member(instructMember)
                .vehicle(vehicle)
                .description(description)
                .instructionType(instructionType)
                .requestAt(requestAt)
                .build();
        workInstructionRepository.save(workInstruction);
        // ì—¬ê¸°ê¹Œì§€ê°€ ê¸°ì¡´ ì‘ì—… ìš”ì²­ ìƒì„± ì½”ë“œ
        // ====================================================================
        
        // ìƒˆë¡­ê²Œ ì¶”ê°€í•œ ì½”ë“œ
        Region contractedRegion = vehicle.getContractedRegion();
        List<Employee> employees = getEmployeesOfContractedRegion(contractedRegion);
        List<String> appPushIds = employees.stream()
                .map(Employee::getAppPushId)
                .collect(Collectors.toList());
        sendSlackNotification(workInstruction);
        sendPushNotification(appPushIds, workInstruction);
        logPushNotification(appPushIds, workInstruction);
    }
}
```

## ì°ì°í•¨ì„ ì•ˆê³ 
ìŠ¬ë™ìœ¼ë¡œ ì•Œë¦¼ì„ ë³´ë‚´ëŠ” ì¹œêµ¬ì™€ í‘¸ì‹œ ì•Œë¦¼ì„ ë³´ë‚´ëŠ” ì¹œêµ¬ë¥¼ ê°ì ì—­í• ì— ë§ê²Œ ì˜ ì¶”ìƒí™”í•´ë‘” ë•ë¶„ì— ì¶”ê°€í•˜ëŠ” ì½”ë“œ ìì²´ëŠ” ë‹¨ìˆœí–ˆë‹¤.
ê·¸ëŸ°ë° ë§ˆìŒ í•œ ì¼ ì— ì•½ê°„ì˜ ì°ì°í•¨ì´ ìˆì—ˆë‹¤. 
- ì‘ì—… ìš”ì²­ì„ ìƒì„±í•˜ëŠ” ë° ìˆì–´ì„œ í•„ìˆ˜ì ì¸ ë¡œì§ì´ ì•„ë‹Œë°, ì—¬ê¸°ì— ê°™ì´ ìˆì–´ë„ ë˜ëŠ”ê±¸ê¹Œ? 
- ë¶€ê°€ ê¸°ëŠ¥ì´ ì‹¤íŒ¨í•˜ë©´ ì‘ì—… ìš”ì²­ ìƒì„±ë„ ë¡¤ë°±ë í…ë°, ì´ëŸ¬ë©´ ì¢€ ê³¤ë€í•˜ê² êµ°...

ì´ëŸ° ì°ì°í•¨ì„ ì•ˆê³  ê°œë°œ í™˜ê²½ì— ë°°í¬í•´ë³´ì•˜ë‹¤. ì½”ë“œëŠ” ë¬¸ì œì—†ì´ ë™ì‘í–ˆë‹¤.
ê·¸ëŸ°ë° ì•± í‘¸ì‹œ ìš”ì²­ì„ ë³´ë‚´ê³  ì„±ê³µ ì—¬ë¶€ë¥¼ ë°›ì•„ì˜¤ëŠ” ë°ê¹Œì§€ ìƒê°ë³´ë‹¤ ì˜¤ëœ ì‹œê°„ì´ ê±¸ë ¸ë‹¤.
ëŒ€ëµ 100ms ë‚´ì™¸ì— ì²˜ë¦¬ë˜ë˜ ìƒì„± apiê°€ 3-4ì´ˆê¹Œì§€ ê±¸ë¦¬ëŠ” ê²½ìš°ê°€ ìƒê²¨ë²„ë ¸ë‹¤.

ì´ê±´ ì¢€ ì•„ë‹Œ ê²ƒ ê°™ë‹¤. ì‘ì—… ìš”ì²­ ìƒì„±í•˜ëŠ” ë° 3ì´ˆë‚˜ ê±¸ë¦¬ë©´ ì•ˆë˜ëŠ”ë°..?? ğŸ¤¯

## ìš”êµ¬ì‚¬í•­ ë‹¤ì‹œ ì“°ê¸°
ë¶€ê°€ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•˜ëŠ” ì‹œê°„ì´ ì‘ì—… ìš”ì²­ ìƒì„± api ì‘ë‹µ ì‹œê°„ì— ì˜í–¥ì„ ì£¼ê³  ìˆì—ˆë‹¤. 
ì´ ì˜í–¥ì„ ì—†ì• ê³ ì ë¶€ê°€ ê¸°ëŠ¥ì„ ê¸°ì¡´ ì½”ë“œì—ì„œ ë¶„ë¦¬í•´ë‚´ë³´ê¸°ë¡œ í–ˆë‹¤.
ì´ ì°¸ì— ë§ˆìŒ í•œ ì¼ ì— ì•ˆê³  ìˆë˜ ì°ì°í•¨ë„ í•´ì†Œí•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•˜ë‹¤.

ë‚˜ë¦„ëŒ€ë¡œ ë³€ê²½í•´ë³¸ ìš”êµ¬ì‚¬í•­ì€ ì•„ë˜ì™€ ê°™ë‹¤.
1. ì‘ì—… ìš”ì²­ì„ ìƒì„±í•˜ëŠ” ì½”ë“œì—ì„œëŠ” ì‘ì—… ìš”ì²­ ìƒì„±ì— í•„ìˆ˜ì ì¸ ë¡œì§ë§Œ ì²˜ë¦¬í•œë‹¤.
2. ë¶€ê°€ ê¸°ëŠ¥ì— ì‹¤íŒ¨í•´ë„ ì‘ì—… ìš”ì²­ ìƒì„±ì€ ì„±ê³µí•´ì•¼ í•œë‹¤. (ë¡¤ë°±ë˜ë©´ ì•ˆë¨)
3. ë¶€ê°€ ê¸°ëŠ¥ì„ ì‹¤í–‰í•˜ëŠ” ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì´ ì‘ì—… ìš”ì²­ ìƒì„± api ì‘ë‹µ ì‹œê°„ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šì•„ì•¼ í•œë‹¤.

## ë§ì´ë“¤ ì•„ëŠ” ì´ì•¼ê¸°, ìŠ¤í”„ë§ ì´ë²¤íŠ¸ë¡œ í•´ê²°í•´ë³´ì.
ë¨¼ì €, 1ë²ˆê³¼ 2ë²ˆ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±ì‹œí‚¤ê¸° ìœ„í•´ì„œ <b>"ì´ë²¤íŠ¸ ë°œí–‰"</b> ë°©ì‹ì„ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆë‹¤.
ì‘ì—… ìš”ì²­ ìƒì„± ì½”ë“œì—ì„œëŠ” í•„ìˆ˜ì ì¸ ë¡œì§ë§Œ ì²˜ë¦¬í•˜ê³ , ë¶€ê°€ ê¸°ëŠ¥ì€ ì‘ì—… ìš”ì²­ì´ ìƒì„±ë˜ì—ˆë‹¤ëŠ” ì´ë²¤íŠ¸ê°€ ë°œí–‰ë˜ë©´ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì´ë‹¤.
ì´ë ‡ê²Œ í•˜ë©´ 'ì‘ì—… ìš”ì²­ ìƒì„±'ê³¼ 'ì•Œë¦¼' ë¡œì§ì„ ë¶„ë¦¬í•˜ê³  ê° ì½”ë“œì—ì„œëŠ” <b>ë‹¨ì¼í•œ ì±…ì„</b>ë§Œì„ ê°€ì§€ê²Œ ëœë‹¤.


ì´ë²¤íŠ¸ ë°œí–‰ / ì†Œë¹„ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” `ApplicationEventPublisher`ë¥¼ ì‚¬ìš©í–ˆë‹¤.
ë¨¼ì €, <i>'ì‘ì—… ìš”ì²­ ìƒì„± ì™„ë£Œ'</i>  ë¼ëŠ” ì´ë²¤íŠ¸ë¥¼ ì •ì˜í–ˆë‹¤.
```java
@Data
@AllArgsConstructor
public class WorkInstructionCreatedEvent {
    private final Vehicle vehicle;
    private final String description;
    private final WorkInstructionType instructionType;
    private final Member instructMember;
    private final LocalDateTime requestAt;
}
```
<br>

ê·¸ë¦¬ê³  ì‘ì—… ìš”ì²­ ìƒì„± ì½”ë“œì—ì„œëŠ” ìœ„ì—ì„œ ì •ì˜í•œ ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•˜ë„ë¡ í–ˆë‹¤.
```java
@Service
@RequiredArgsConstructor
public class WorkInstructionService {
    private final ApplicationEventPublisher eventPublisher;
    // ìƒëµ
    // ê°ì¢… repository, domain service ì£¼ì… 
    
    @Transactional
    public void createWorkInstruction(Long memberId, String vehicleId, String description, WorkInstructionType instructionType, LocalDateTime requestAt) {
        Vehicle vehicle = getVehicle(vehicleId);
        Member instructMember = getMember(memberId);
        
        WorkInstructionEntity workInstruction = WorkInstructionEntity.builder()
            .member(instructMember)
            .vehicle(vehicle)
            .description(description)
            .instructionType(instructionType)
            .requestAt(requestAt)
            .build();
        workInstructionRepository.save(workInstruction);
      
        // ì´ë²¤íŠ¸ ë°œí–‰
        eventPublisher.publishEvent(new WorkInstructionCreatedEvent(
            vehicle,
            description,
            instructionType,
            instructMember,
            requestAt
        ));
    }
}
```
<br>

ì´ë ‡ê²Œ <i>'ì‘ì—… ìš”ì²­ ìƒì„± ì™„ë£Œ'</i> ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•˜ë©´, êµ¬ë…í•˜ëŠ” ê³³ì—ì„œ ì´ë²¤íŠ¸ë¥¼ ì†Œë¹„í•´ ë¶€ê°€ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
í•´ë‹¹ ì´ë²¤íŠ¸ë¥¼ êµ¬ë…í•˜ëŠ” `Listner` ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì¶”ê°€í–ˆë‹¤.
`Listner`ì—ì„œ ìŠ¬ë™ ì•Œë¦¼ì„ ë³´ë‚´ëŠ” ë¡œì§, í‘¸ì‹œ ì•Œë¦¼ì„ ë³´ë‚´ëŠ” ë¡œì§, ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ë¡œì§ì„ êµ¬í˜„í•¨ìœ¼ë¡œì¨ 
ê° ì½”ë“œì—ì„œ ë‹¨ì¼í•œ ì±…ì„ì„ ê°€ì§€ê²Œë” í–ˆë‹¤. (1ë²ˆ ìš”êµ¬ì‚¬í•­ ë§Œì¡± âœ…)
- `WorkInstructionService` : ì‘ì—… ìš”ì²­ì„ ìƒì„±í•˜ëŠ” ì±…ì„
- `WorkInstructionCreatedListener` : ì‘ì—… ìš”ì²­ ìƒì„± ì™„ë£Œë¥¼ ì™¸ë¶€ë¡œ ì•Œë¦¬ëŠ” ì±…ì„

```java
@Component
@RequiredArgsConstructor
public class WorkInstructionCreatedListener {
    // ìƒëµ
    // ê°ì¢… ì˜ì¡´ì„± ì£¼ì…
    
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
    public void handleWorkInstructionCreatedEvent(WorkInstructionCreatedEvent event) {
        Region contractedRegion = event.getVehicle().getContractedRegion();
        List<Employee> employees = getEmployeesOfContractedRegion(contractedRegion);
        List<String> appPushIds = employees.stream()
                .map(Employee::getAppPushId)
                .collect(Collectors.toList());
        sendSlackNotification(event);
        sendPushNotification(appPushIds, event);
        logPushNotification(appPushIds, event);
    }
}
```
<br>

ìœ„ì™€ ê°™ì´, `@TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)` 
ì• ë…¸í…Œì´ì…˜ìœ¼ë¡œ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì´í›„ì— ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ë„ë¡ í–ˆë‹¤.
ì´ë ‡ê²Œ í•˜ë©´ ë¶€ê°€ ê¸°ëŠ¥ ì²˜ë¦¬ì— ì‹¤íŒ¨í•˜ë”ë¼ë„ ì‘ì—… ìš”ì²­ ìƒì„± íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë˜ì§€ ì•Šê²Œ ëœë‹¤. (2ë²ˆ ìš”êµ¬ì‚¬í•­ ë§Œì¡± âœ…)


> ì‚¬ë‚´ì—ì„œ ì•± í‘¸ì‹œ ì•Œë¦¼ì„ ì„±ê³µì ìœ¼ë¡œ ë³´ë‚¸ ê²½ìš° RDBì— ê¸°ë¡í•´ë‘ê³  ìˆë‹¤. 
`logPushNotification()`ì´ ìœ„ ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ”ë°, ì´ ê³¼ì •ì„ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì–´ì„œ ì²˜ë¦¬í•˜ê³ ì `@Transactional` ì• ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í–ˆë‹¤.
í•˜ì§€ë§Œ `TransactionPhase=AFTER_COMMIT` ì˜µì…˜ì„ ì£¼ì—ˆê¸° ë•Œë¬¸ì—, ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œëŠ” ë”ì´ìƒ ìƒˆë¡œìš´ ì»¤ë°‹ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
ë”°ë¼ì„œ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆë„ë¡ `@Transactional(propagation = Propagation.REQUIRES_NEW)` ì˜µì…˜ì„ ì¶”ê°€í–ˆë‹¤.

<br>

## API ì‘ë‹µ ì‹œê°„ì€ ê·¸ëŒ€ë¡œì¸ë°?
ìŠ¤í”„ë§ ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•´ 1ë²ˆê³¼ 2ë²ˆ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±ì‹œí‚¬ ìˆ˜ ìˆì—ˆë‹¤. 
í•˜ì§€ë§Œ, ë‹¤ì‹œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì•„ë„ ì‘ì—… ìš”ì²­ ìƒì„± api ì‘ë‹µ ì‹œê°„ì€ ì—¬ì „íˆ ëŠë ¤ì§„ ìƒíƒœì˜€ë‹¤.

ì´ìœ ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ìŠ¤ë ˆë“œì— ìˆì—ˆë‹¤. `@EventListener`ëŠ” ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•œ ìŠ¤ë ˆë“œì—ì„œ ê°™ì´ ì‹¤í–‰ëœë‹¤.
ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´, ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•œ Serviceì™€ ì´ë²¤íŠ¸ë¥¼ êµ¬ë…í•˜ëŠ” Listenerê°€ ê°™ì€ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ê³  ìˆì—ˆë‹¤.
![running-same-thread](/assets/images/async-aop/running-same-thread.png)
<br>

ìŠ¤í”„ë§ì—ì„œëŠ” í•œ ìŠ¤ë ˆë“œì—ì„œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ”ë°, ê°™ì€ ìŠ¤ë ˆë“œì—ì„œ ì´ë²¤íŠ¸ êµ¬ë… ì‘ì—…ê¹Œì§€ ìˆ˜í–‰í•œë‹¤ë©´
í•´ë‹¹ ì‘ì—…ì´ ëë‚  ë•Œ ê¹Œì§€ ìŠ¤ë ˆë“œê°€ ë¸”ë¡ë˜ì–´ ì‘ë‹µì„ ë°˜í™˜í•˜ì§€ ëª»í•˜ëŠ” ê²ƒì´ë‹¤.

ì¦‰, ë¶€ê°€ ê¸°ëŠ¥ì„ ì‹¤í–‰í•˜ëŠ” ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì´ api ì‘ë‹µ ì‹œê°„ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šìœ¼ë ¤ë©´ 
'ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ìŠ¤ë ˆë“œ'ì™€ 'ì´ë²¤íŠ¸ë¥¼ êµ¬ë…í•´ ë¶€ê°€ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•˜ëŠ” ìŠ¤ë ˆë“œ'ë¥¼ ë¶„ë¦¬í•´ì•¼ í•œë‹¤.

ì´ë¥¼ ìœ„í•´ ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” `@Async` ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ë³´ê¸°ë¡œ í–ˆë‹¤.

## @Asyncë¡œ í•´ê²°í•´ë³´ì.
[Spring Framework ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/annotation/Async.html)
ì— ë‚˜ì™€ ìˆëŠ” ì„¤ëª…ì„ ë³´ë©´ 
> Annotation that marks a method as a candidate for asynchronous execution.
Can also be used at the type level, in which case all the type's methods are considered as asynchronous.

ë¼ê³  ë˜ì–´ìˆë‹¤. `@Async` ì• ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ í•´ë‹¹ ë©”ì„œë“œëŠ” 'ë¹„ë™ê¸°ë¡œ ì‹¤í–‰ë  ìˆ˜ ìˆëŠ” í›„ë³´'ê°€ ëœë‹¤.
ì¦‰, `@Async` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œ ê³³ì—ì„œ `@Async` ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šìœ¼ë©°
`@Async` ë©”ì„œë“œëŠ” ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.

ê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì´ `@Async` ì• ë…¸í…Œì´ì…˜ì„ ë¶™ì´ê³  í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì•˜ë‹¤. 
`Listener`ê°€ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë  ê²ƒì„ ê¸°ëŒ€í–ˆì§€ë§Œ, ì—¬ì „íˆ ê°™ì€ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ê³  ìˆì—ˆë‹¤.
```java
public class WorkInstructionCreatedListener {
    // ìƒëµ
    // ê°ì¢… ì˜ì¡´ì„± ì£¼ì…
    
    @Async
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
    public void handleWorkInstructionCreatedEvent(WorkInstructionCreatedEvent event) {
        // ìƒëµ
    }
}
```

![async-same-thread.png](/assets/images/async-aop/async-same-thread.png)

ì°¾ì•„ë³´ë‹ˆ, `@Configuration` í´ë˜ìŠ¤ì— `@EnableAsync` ì• ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì•¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë™ì‘í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤.
ê·¸ë˜ì„œ `@EnableAsync` ì• ë…¸í…Œì´ì…˜ì„ ë¶™ì´ê³  ë‹¤ì‹œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì•˜ì„ ë•Œ, 
`Listener`ê°€ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.

```java
@EnableAsync
@SpringBootApplication
public class SampleApplication {

    public static void main(String[] args) {
        SpringApplication.run(SampleApplication.class, args);
    }
}

// ===============================
@Component
public class WorkInstructionCreatedListener {
    // ìƒëµ
    // ê°ì¢… ì˜ì¡´ì„± ì£¼ì…

    @Async
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
    public void handleWorkInstructionCreatedEvent(WorkInstructionCreatedEvent event) {
        // ìƒëµ
    }
}
```
![async-different-thread.png](/assets/images/async-aop/async-different-thread.png)


## ì´ê±° ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ê±°ì§€?
`@Async`ë§Œ ë¶™ì˜€ì„ ë•Œì—ëŠ” ë¹„ë™ê¸°ì ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•Šê³ , `@EnableAsync`ë¥¼ ë¶™ì—¬ì•¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë™ì‘í•¨ì„ í™•ì¸í–ˆë‹¤.
ì™œ `@EnableAsync`ë¥¼ ë¶™ì—¬ì•¼ í•˜ëŠ”ì§€, ì–´ë–¤ ê³¼ì •ì„ ê±°ì³ì„œ ë©”ì„œë“œ í˜¸ì¶œì´ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê²ƒì¸ì§€ ê¶ê¸ˆí•´ì¡Œë‹¤.
(ì´ ê¸€ì„ ì“°ê²Œ ëœ ì´ìœ ì´ê¸°ë„ í•˜ë‹¤.) 

ì´ê²ƒì €ê²ƒ ì°¾ì•„ë³´ë‹¤ê°€, [https://dzone.com/articles/effective-advice-on-spring-async-part-1](
https://dzone.com/articles/effective-advice-on-spring-async-part-1
) ì—ì„œ ì•„ë˜ì™€ ê°™ì€ ì„¤ëª…ì„ ì°¾ì•˜ë‹¤.
> When you put an Async annotation on a method underlying it, 
> it creates a proxy of that object where Async is defined (JDK Proxy/CGlib) based on the proxyTargetClass property. 
> Then, Spring tries to find a thread pool associated with the context to submit this method's logic as a separate path of execution.

`@Async` ì• ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ í•´ë‹¹ ë©”ì„œë“œë¥¼ ê°ì‹¸ëŠ” í”„ë¡ì‹œ ê°ì²´ê°€ ìƒì„±ë˜ê³ ,
ìŠ¤í”„ë§ì€ í•´ë‹¹ ë©”ì„œë“œë¥¼ ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ìŠ¤ë ˆë“œ í’€ì„ ì°¾ì•„ì„œ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•œë‹¤ê³  í•œë‹¤.

í”„ë¡ì‹œ? ìŠ¤ë ˆë“œ í’€ì„ ì–¸ì œ ì°¾ëŠ”ê±°ì§€? ì˜ ì´í•´ê°€ ê°€ì§€ ì•Šì•„ì„œ ì§ì ‘ ì½”ë“œë¥¼ ê¹Œë³´ì•˜ë‹¤. ğŸ› ï¸

## ì½”ë“œ ê¹Œë³´ê¸°
ë¨¼ì € `@EnableAsync` ì• ë…¸í…Œì´ì…˜ì´ ì •ì˜ëœ ì½”ë“œë¥¼ ì°¾ì•„ ë“¤ì–´ê°€ë³´ì•˜ë‹¤.

### 1. @EnableAsync
```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Import(AsyncConfigurationSelector.class)
public @interface EnableAsync {
    Class<? extends Annotation> annotation() default Annotation.class;
    
    boolean proxyTargetClass() default false;
    
    AdviceMode mode() default AdviceMode.PROXY;
    
    int order() default Ordered.LOWEST_PRECEDENCE;
}
```
`@EnableAsnyc` ì½”ë“œë¥¼ ë³´ë©´, `@Import` ì• ë…¸í…Œì´ì…˜ì„ í†µí•´ `AsyncConfigurationSelector`ë¥¼ importí•˜ê³  ìˆë‹¤.
`AsyncConfigurationSelector` í´ë˜ìŠ¤ ì´ë¦„ìœ¼ë¡œë§Œ ë³´ì•˜ì„ ë•Œ, ì•„ë˜ì™€ ê°™ì€ ì—­í• ì„ ì˜ˆìƒí•  ìˆ˜ ìˆì—ˆë‹¤. 
1. `@EnableAsync` ì• ë…¸í…Œì´ì…˜ì„ ë¶™ì˜€ì„ ë•Œ Asyncì™€ ê´€ë ¨ëœ `Configuration`ì„ ì¶”ê°€í•˜ëŠ” ì—­í• ì„ í•  ê²ƒ ê°™ë‹¤.
2. ì¡°ê±´ì— ë”°ë¼ ì„œë¡œ ë‹¤ë¥¸ `Configuration` ì„ ì„ íƒí•˜ëŠ” ì—­í• ì„ í•  ê²ƒ ê°™ë‹¤.

ì•„ë˜ëŠ” `AsyncConfigurationSelector` í´ë˜ìŠ¤ì˜ ì½”ë“œì´ë‹¤.
![async-configuration-selector.png](/assets/images/async-aop/async-configuration-selector.png)


ì˜ˆìƒí–ˆë˜ ë°”ì™€ ê°™ì´, ì¡°ê±´ì— ë”°ë¼ ì„œë¡œ ë‹¤ë¥¸ `Configuration` ì„ ì„ íƒí•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•˜ê³  ìˆì—ˆë‹¤.
`AdviceMode`ì— ë”°ë¼ ë‹¤ë¥¸ `Configuration` ì„ ì¶”ê°€í•˜ëŠ”ë°, 
ê¸°ë³¸ì ìœ¼ë¡œ `@EnableAsync` ì—ì„œëŠ” ì•„ë˜ ì½”ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë“¯ì´ `AdviceMode.PROXY`ê°€ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆë‹¤.
ë”°ë¼ì„œ ê¸°ë³¸ê°’ìœ¼ë¡œ `ProxyAsyncConfiguration`ë¥¼ importí•˜ê²Œ ëœë‹¤.
```java
// @EnableAsync ì½”ë“œ ì¼ë¶€
AdviceMode mode() default AdviceMode.PROXY;
```

### 2. ProxyAsyncConfiguration
ìœ„ì—ì„œ `@EnableAsync`ë¥¼ í†µí•´ `ProxyAsyncConfiguration`ê°€ importë˜ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤. 
ê·¸ëŸ¼ `ProxyAsyncConfiguration`ì—ì„œëŠ” ì–´ë–¤ ì¼ì„ í• ê¹Œ?

![proxy-async-configuration.png](/assets/images/async-aop/proxy-async-configuration.png)
ì½”ë“œë¥¼ í™•ì¸í•´ë³´ë©´ `AsyncAnnotationBeanPostProcessor`ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê³  ìˆë‹¤.

"ë¹ˆ í›„ì²˜ë¦¬ê¸°" (BeanPostProcessor)ëŠ” ìŠ¤í”„ë§ ë¹ˆ ì €ì¥ì†Œì— íŠ¹ì • ë¹ˆì„ ë“±ë¡í•˜ê¸° ì „ì— ì¡°ì‘í•œë‹¤. 

#### BeanPostProcessorì˜ ë“±ì¥
ì—¬ê¸°ì„œ ì ê¹, BeanPostProcessorê°€ ë­”ì§€ ì•Œì•„ë³´ì.

`A` ê°ì²´ê°€ ìˆê³  ì´ë¥¼ í˜¸ì¶œí•  ë•Œ ë¡œê¹…ì„ ë”í•˜ëŠ” ìƒí™©ì„ ìƒê°í•´ë³´ì.
ë‹¨ìˆœíˆ `A` ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œì— ë¡œê¹…ì„ ì¶”ê°€í•˜ë©´ ëœë‹¤. 
í•˜ì§€ë§Œ ì´ ë¡œê¹…ì„ ì¶”ê°€í•˜ëŠ” ë¶€ë¶„ì´ `A` ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œì— ë“¤ì–´ê°€ì§€ ì•Šê²Œ í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ? 

<b>í”„ë¡ì‹œ</b> ê°œë…ì„ ì‚¬ìš©í•˜ë©´ ì´ëŸ° ìƒí™©ì„ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
`A` ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œì— ì¶”ê°€ì ì¸ ë™ì‘ì„ ë„£ì§€ ì•Šê³ , `A` ê°ì²´ë¥¼ ê°ì‹¸ëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
ê·¸ë¦¬ê³  í”„ë¡ì‹œ ê°ì²´ì—ì„œëŠ” `A` ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê¸° ì „ì— ì¶”ê°€ì ì¸ ë™ì‘ì„ ìˆ˜í–‰í•˜ê³ , `A` ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.
`A` ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê³³ì—ì„œëŠ” `A` ê°ì²´ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ì‹¤ì œë¡œëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ í˜¸ì¶œí•˜ê²Œë” ë§Œë“ ë‹¤.
ì´ë ‡ê²Œ í•˜ë©´ 'ì¶”ê°€ì ì¸ ë™ì‘'ì„ `A` ê°ì²´ ìƒì„± ì½”ë“œì— ë„£ì§€ ì•Šì•„ë„ ë˜ë©°, `A` ê°ì²´ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ê°‘ìê¸° ì™œ í”„ë¡ì‹œì— ëŒ€í•´ ì´ì•¼ê¸°ë¥¼ í•˜ëƒë©´, BeanPostProcessorëŠ” í”„ë¡ì‹œë¥¼ ìƒì„±í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.
ì•ì„œ ì–¸ê¸‰í•œ ê²ƒì²˜ëŸ¼ BeanPostProcessorëŠ” íŠ¹ì • ë¹ˆì„ ì¡°ì‘í•œ ë’¤ ìŠ¤í”„ë§ ë¹ˆ ì €ì¥ì†Œì— ë“±ë¡í•  ìˆ˜ ìˆë‹¤.
ìœ„ì˜ ì˜ˆì‹œì— ì ìš©í•´ë³¸ë‹¤ë©´, `A` ê°ì²´ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ëŒ€ì‹  `A` ê°ì²´ë¥¼ ì ë‹¹íˆ ì¡°ì‘í•´ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•œë’¤ ì´ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

ì¦‰, BeanPostProcessorë¥¼ ì‚¬ìš©í•˜ë©´ í”„ë¡ì‹œ ê°ì²´ë¥¼ ì‹¤ì œ ê°ì²´ ëŒ€ì‹  ë¹ˆìœ¼ë¡œ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.

![bean-post-processor-flow.png](/assets/images/async-aop/bean-post-processor-flow.png)


### AsyncAnnotationBeanPostProcessor
`ProxyAsyncConfiguration` ì—ì„œ `AsyncAnnotationBeanPostProcessor`ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í–ˆë‹¤.
ë¹ˆ í›„ì²˜ë¦¬ê¸° ì—­í• ì— ë”°ë¼, ì‹¤ì œ ê°ì²´ê°€ 'ë¹„ë™ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰ë  ìˆ˜ ìˆë„ë¡' ì¡°ì‘í•´ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì´ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•  ê²ƒì´ë¼ ì˜ˆìƒí•´ë³¼ ìˆ˜ ìˆì—ˆë‹¤.
ê·¸ëŸ¼ `AsyncAnnotationBeanPostProcessor`ëŠ” ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê±¸ê¹Œ? 

`AsyncAnnotationBeanPostProcessor` í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë¥¼ ë³´ë©´ ì´ ë¹ˆ í›„ì²˜ë¦¬ê¸°ê°€ í•˜ëŠ” ì¼ì„ í¬ê²Œ ì„¸ê°€ì§€ë¡œ ì •ë¦¬í•´ë³¼ ìˆ˜ ìˆë‹¤.
1. Executor ì„¤ì •
2. annotation type ì„¤ì •
3. AsyncAnnotationAdvisor ìƒì„±

#### 1. Executor ì„¤ì •
![async-annotation-bean-post-processor-configure.png](/assets/images/async-aop/async-annotation-bean-post-processor-configure.png)
ì´ ë©”ì„œë“œëŠ” ìœ„ì˜ `ProxyAsyncConfiguration`ì—ì„œ BeanPostProcessorë¥¼ ë“±ë¡í•  ë•Œ í˜¸ì¶œí•œë‹¤.
`Executor`ë¥¼ ì„¤ì •í•´ì£¼ê³  ìˆëŠ”ë°, ì´ `Executor`ê°€ ë¬´ì—‡ì¸ì§€ëŠ” ì•„ë˜ì—ì„œ ë‹¤ë¤„ë³´ê² ë‹¤.

#### 2. annotation type ì„¤ì •
![async-annotation-bean-post-processor-set-async-annotation-type.png](/assets/images/async-aop/async-annotation-bean-post-processor-annotation-type.png)
`@EnableAsync` ì• ë…¸í…Œì´ì…˜ì—ì„œ `annotation` ì†ì„±ì„ ì„¤ì •í•  ìˆ˜ ìˆì—ˆëŠ”ë°
ì´ ì†ì„±ì„ `ProxyAsyncConfiguration`ì—ì„œ 
`bpp.setAsyncAnnotationType(customAsyncAnnotation)` ë¥¼ í†µí•´ beanPostProcessorì— ì „ë‹¬í•˜ê³  ìˆë‹¤.
ë¹ˆ í›„ì²˜ë¦¬ê¸°ì—ì„œ í•˜ëŠ” ì¼ì„ ìƒê°í•´ë³´ì•˜ì„ ë•Œ, ë¹ˆ í›„ì²˜ë¦¬ê¸°ê°€ "ì–´ë–¤ ì• ë…¸í…Œì´ì…˜ì´ ë¶™ì€ ë©”ì„œë“œë¥¼ í”„ë¡ì‹œë¡œ ë§Œë“¤ ê²ƒì¸ì§€" ê²°ì •í•˜ê¸° ìœ„í•œ ì •ë³´ë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.
ì˜ˆìƒëŒ€ë¡œ ë™ì‘í•˜ëŠ”ì§€ë„ ì•„ë˜ì—ì„œ í™•ì¸í•´ë³´ê² ë‹¤.

#### 3. AsyncAnnotationAdvisor ìƒì„±
![async-annotation-bean-post-processor.png](/assets/images/async-aop/async-annotation-bean-post-processor-bean-factory.png)
`setBeanFactory` ì—ì„œ `AsyncAnnotationAdvisor`ë¥¼ ìƒì„±í•˜ê³  ìˆë‹¤.

`Advisor` ëŠ” ì–´ë–¤ ì—­í• ì„ ìˆ˜í–‰í•˜ê¸¸ë˜ `AsyncAnnotationAdvisor`ê°€ í•„ìš”í•œ ê²ƒì¸ì§€ ê¶ê¸ˆí•´ì¡Œë‹¤.

##### Advisorì˜ ë“±ì¥
[Spring Framework ê³µì‹ ë¬¸ì„œ - Advisor](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/aop/Advisor.html)
ì— ë”°ë¥´ë©´,
> Base interface holding AOP advice (action to take at a joinpoint) and a filter determining the applicability of the advice (such as a pointcut).

ë¼ê³  ë˜ì–´ìˆë‹¤. `Advisor`ëŠ” `Pointcut`ì´ë¼ëŠ” ì¹œêµ¬ë¥¼ í†µí•´ ì–´ë–¤ ì¡°ì¸í¬ì¸íŠ¸ì— ì–´ë–¤ ë¶€ê°€ ê¸°ëŠ¥(`Advice`)ì„ ì ìš©í• ì§€ ê²°ì •í•œë‹¤.

`Pointcut`ì€ ì–´ë””ì— ë¶€ê°€ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ê²ƒì¸ì§€ ê²°ì •í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•œë‹¤. 
![pointcut-implementations.png](/assets/images/async-aop/pointcut-implementation.png)






### AsyncAnnotationAdvisor

#### AnnotationAsyncExecutionInterceptor

#### AnnotationMatchingPointcut

### SimpleAsyncTaskExecutor

### AsyncBeanPostProcessor ë¹ˆ ë“±ë¡ìœ¼ë¡œ ë‹¤ì‹œ ëŒì•„ê°€ì„œ
ë‹¤ì‹œ `ProxyAsyncConfiguration`ë¡œ ëŒì•„ì™€ì„œ, `AsyncAnnotationBeanPostProcessor`ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ì½”ë“œë¥¼ ë³´ì.
```java
AsyncAnnotationBeanPostProcessor bpp = new AsyncAnnotationBeanPostProcessor();
bpp.configure(this.executor, this.exceptionHandler);
Class<? extends Annotation> customAsyncAnnotation = this.enableAsync.getClass("annotation");
if (customAsyncAnnotation != AnnotationUtils.getDefaultValue(EnableAsync.class, "annotation")) {
    bpp.setAsyncAnnotationType(customAsyncAnnotation);
}
```
`bpp.configure` ë™ì‘ì€ ì´í›„ì— ì‚´í´ë³´ê² ë‹¤.

`@EnableAsync` ì• ë…¸í…Œì´ì…˜ì—ì„œ `annotation` ì†ì„±ì„ ì„¤ì •í•  ìˆ˜ ìˆì—ˆëŠ”ë°
ì´ ì†ì„±ì„ `bpp.setAsyncAnnotationType(customAsyncAnnotation)` ë¥¼ í†µí•´ beanPostProcessorì— ì „ë‹¬í•˜ê³  ìˆë‹¤.
ë¹ˆ í›„ì²˜ë¦¬ê¸°ì—ì„œ í•˜ëŠ” ì¼ì„ ìƒê°í•´ë³´ì•˜ì„ ë•Œ,
ë¹ˆ í›„ì²˜ë¦¬ê¸°ê°€ "ì–´ë–¤ ì• ë…¸í…Œì´ì…˜ì´ ë¶™ì€ ë©”ì„œë“œë¥¼ í”„ë¡ì‹œë¡œ ë§Œë“¤ ê²ƒì¸ì§€" ê²°ì •í•˜ê¸° ìœ„í•œ ì •ë³´ë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒ ê°™ë‹¤.

ì˜ˆìƒí•œ ê²ƒì²˜ëŸ¼ ì‹¤ì œë¡œ ë™ì‘í•˜ëŠ”ì§€ `AsyncAnnotationBeanPostProcessor` ì½”ë“œë¥¼ í™•ì¸í•´ë³´ì•˜ë‹¤.

## AsyncConfigurer êµ¬í˜„í•´ë³´ê¸°



ì´ ë¹ˆ í›„ì²˜ë¦¬ê¸° ì•ˆì˜ ë™ì‘ì„ ë³´ì
AsyncAnnotationAdvisorë¥¼ ìƒì„±í•œë‹¤
ì´ ì•ˆì—ì„œëŠ” advice, pointcutì„ ìƒì„±í•  ê²ƒì´ë¼ê³  ìœ ì¶”í•  ìˆ˜ ìˆë‹¤.
pointcutì—ì„œ async annotationì„ ì°¾ì•„ë‚¼ ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ê³ 
adviceì—ì„œëŠ” pointcutìœ¼ë¡œ ì°¾ì€ ëŒ€ìƒì„ ì–´ë–»ê²Œ ê¾¸ë©°ì¤„ ê²ƒì¸ì§€ ê²°ì •í•  ê²ƒì´ë‹¤.

ê·¸ëŸ¼ ì§„ì§œ ì•ˆìœ¼ë¡œ ë“¤ì–´ê°€ë³´ì

this.advice = buildAdvice(executor, exceptionHandler);
this.pointcut = buildPointcut(asyncAnnotationType);

exceutorì—ëŠ” AbstractAsyncConfigurationì—ì„œ executorë¥¼ ì„¤ì •í•´ì¤€ë‹¤.
AsyncConfigurerë¥¼ êµ¬í˜„í•œ ë¹ˆì´ ìˆë‹¤ë©´ ê·¸ ë¹ˆì„ ì‚¬ìš©í•˜ê³ , ì—†ë‹¤ë©´ SimpleAsyncTaskExecutorë¥¼ ì‚¬ìš©í•œë‹¤.


buildAdvice ë©”ì„œë“œë¥¼ ë³´ë©´
AnnotationAsyncExecutionInterceptorë¥¼ ìƒì„±í•œë‹¤.

ì´ interceptorì—ì„œ í”„ë¡ì‹œì—ì„œ ì–´ë–¤ ë¶€ê°€ ê¸°ëŠ¥ì„ ì²˜ë¦¬í• ì§€ ì •ì˜í•œë‹¤.
ì´ interceptorëŠ” MethodInterceptorë¥¼ êµ¬í˜„í•˜ê³  ìˆë‹¤.

MethodInterceptorëŠ” invoke ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
invoke ë©”ì„œë“œëŠ” ë©”ì„œë“œ ì‹¤í–‰ ì „í›„ì— ìˆ˜í–‰í•  ì‘ì—…ì„ ì •ì˜í•˜ëŠ”ë°,
executorë¥¼ ì„ íƒí•˜ê³  ë©”ì„œë“œë¥¼ callableë¡œ ê°ì‹¸ì„œ executorì— ì „ë‹¬í•˜ëŠ” ë°©ì‹ì´ë‹¤.

pointcutì—ì„œëŠ” AnnotationMatchingPointcutìœ¼ë¡œ Async ì• ë…¸í…Œì´ì…˜ì„ ì°¾ëŠ”ë‹¤.
ì´ pointcutì„ ë§Œì¡±í•˜ëŠ” ë©”ì„œë“œê°€ ìˆë‹¤ë©´ ìœ„ì˜ adviceë¥¼ ì ìš©í•œ í”„ë¡ì‹œë¥¼ í†µí•´ ë©”ì„œë“œê°€ ì‹¤í–‰ë  ê²ƒì´ë‹¤.

ê·¸ëŸ¬ë©´ ì´ê²Œ ì–´ë–»ê²Œ ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ëŠ”ê°€?
executorì— ê·¸ ë‹µì´ ìˆë‹¤.

ë„˜ê²¨ì§„ Executorê°€ ì—†ë‹¤ë©´ SimpleAsyncTaskExecutorë¥¼ ì‚¬ìš©í•œë‹¤.
futureTaskë¥¼ ìƒì„±í•˜ê³ , executor.execute(futureTask)ë¥¼ í˜¸ì¶œí•œë‹¤.


## ë§ˆë¬´ë¦¬í•˜ë©°
ë””ë²„ê¹… ëª¨ë“œë¡œ ì‹¤í–‰í•´ë³´ê³ 

í”„ë¡ì‹œ, aop ì— ëŒ€í•œ ë‚´ìš©ë„ ì¢€ ê³µë¶€í•´ë³´ê³ . 
















